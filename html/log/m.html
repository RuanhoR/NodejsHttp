<html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>聊天室</title><style>.b{background-color:#2c3e50;color:#fff;padding:15px;text-align:center;font-size:1.2em}.e{overflow-y:auto;background-color:#f9f9f9}.message{margin-bottom:15px;display:flex;flex-direction:column}.message-user{font-weight:700;color:#2c3e50;margin-bottom:5px}.message-content{background-color:#fff;padding:10px15px;border-radius:15px;max-width:70%;box-shadow:1px2pxrgba(0,0,0,.1)}.message-time{font-size:.8em;color:#999;margin-top:5px}.g{display:flex;padding:15px;border-top:1pxsolid#eee;background-color:#fff}.chat-input{padding:10px15px;border:1pxsolid#ddd;border-radius:20px;outline:0;font-size:1em}.j{background-color:#2c3e50;color:#fff;border:none;border-radius:20px;margin-left:10px;cursor:pointer;transition:background-color .3s}.j:hover{background-color:#1a252f}#h{height:100px;border-radius:10px}</style></head><body><div class="b">聊天室<button id="c">刷新</button><button id="d">停止</button></div><div class="e" id="f"></div><div class="g"><textarea id="h"></textarea><button class="j" id="k">发送</button></div><script>!function(){var e=document.getElementById("f"),t=document.getElementById("h");function n(){fetch("/api/message/get").then(e=>e.json()).then(t=>{e.innerHTML="",t.forEach(t=>{!function(t){const n=document.createElement("div");n.className="message";const c=document.createElement("div");c.className="message-user",c.textContent=t.user;const o=document.createElement("div");o.className="message-content",o.innerHTML=t.message.replace(/img,@(.+?)$/gim,(e,t)=>"<img src='"+t.slice(0,t.length-1)+"'></img>").replace(/\n/g,"<br>");const a=document.createElement("div");a.className="message-time",a.textContent=new Date(t.time).toLocaleString(),n.appendChild(c),n.appendChild(o),n.appendChild(a),e.appendChild(n),e.scrollTop=e.scrollHeight}(t)})})}let c;document.getElementById("k").addEventListener("click",function(){const e=t.value.trim();e&&fetch("/api/message/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})}).then(e=>e.json()).then(e=>{200===e.code?(t.value="",n()):e.msg==='ERR_NO_log'&&confirm('未登录')&&(window.location.href="/log?source=p?page=m.html")})}),n(),document.getElementById("c").addEventListener("click",function(){c||(c=setInterval(n,1e3))}),document.getElementById("d").addEventListener("click",function(){c&&clearInterval(c)})}()</script></body></html>